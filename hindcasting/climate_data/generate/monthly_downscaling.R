
# Script to downscale HadCM3B altitude from 30min to 15 min
# Temperatures are downscaled with altitude



wd <- "C:/Users/vandermeersch/Documents/CEFE/phd/hindcasting/climate_data/generate"

source(file.path(wd, "functions", "monthly_downscale_with_altitude.R"))
source(file.path(wd, "functions", "monthly_downscale.R"))


intervals <- list(c(0, 2000), c(2001, 4000), c(4001, 6000), c(6001, 8000), c(8001, 10000))

years_lists <- list(
  list(c((250+15):(250-15)), c((500+15):(500-15)), c((750+15):(750-15)), c((1000+15):(1000-15)), 
       c((1250+15):(1250-15)), c((1500+15):(1500-15)), c((1750+15):(1750-15)), c(2000:(2000-15))),
  list(c((2000+15):2001), c((2250+15):(2250-15)), c((2500+15):(2500-15)), c((2750+15):(2750-15)), c((3000+15):(3000-15)), 
       c((3250+15):(3250-15)), c((3500+15):(3500-15)), c((3750+15):(3750-15)), c(4000:(4000-15))),
  list(c((4000+15):4001), c((4250+15):(4250-15)), c((4500+15):(4500-15)), c((4750+15):(4750-15)), c((5000+15):(5000-15)), 
       c((5250+15):(5250-15)), c((5500+15):(5500-15)), c((5750+15):(5750-15)), c(6000:(6000-15))),
  list(c((6000+15):6001), c((6250+15):(6250-15)), c((6500+15):(6500-15)), c((6750+15):(6750-15)), c((7000+15):(7000-15)), 
       c((7250+15):(7250-15)), c((7500+15):(7500-15)), c((7750+15):(7750-15)), c(8000:(8000-15))),
  list(c((8000+15):8001), c((8250+15):(8250-15)), c((8500+15):(8500-15)), c((8750+15):(8750-15)), c((9000+15):(9000-15)), 
       c((9250+15):(9250-15)), c((9500+15):(9500-15)), c((9750+15):(9750-15)), c(10000:(10000-15)))
)


intervals <- list(c(10001, 12000), c(12001, 14000), c(14001, 16000), c(16001, 18000))

years_lists <- list(
  list(c((10000+15):10001), c((10250+15):(10250-15)), c((10500+15):(10500-15)), c((10750+15):(10750-15)), c((11000+15):(11000-15)), 
       c((11250+15):(11250-15)), c((11500+15):(11500-15)), c((11750+15):(11750-15)), c(12000:(12000-15))),
  list(c((12000+15):12001), c((12250+15):(12250-15)), c((12500+15):(12500-15)), c((12750+15):(12750-15)), c((13000+15):(13000-15)), 
       c((13250+15):(13250-15)), c((13500+15):(13500-15)), c((13750+15):(13750-15)), c(14000:(14000-15))),
  list(c((14000+15):12001), c((14250+15):(14250-15)), c((14500+15):(14500-15)), c((14750+15):(14750-15)), c((15000+15):(15000-15)), 
       c((15250+15):(15250-15)), c((15500+15):(15500-15)), c((15750+15):(15750-15)), c(16000:(16000-15))),
  list(c((16000+15):16001), c((16250+15):(16250-15)), c((16500+15):(16500-15)), c((16750+15):(16750-15)), c((17000+15):(17000-15)), 
       c((17250+15):(17250-15)), c((17500+15):(17500-15)), c((17750+15):(17750-15)), c(18000:(18000-15)))
)               


in_folder <- "D:/climate/HadCM3B_60Kyr_Climate/2023_dataset/raw"
out_folder <- "D:/climate/HadCM3B_60Kyr_Climate/2023_dataset/raw_dscl_15min"
ncores <- 10

# Downscale temperatures (parallel computation)
for(i in 1:length(intervals)){
  
  monthly_downscale_with_altitude(yr_interval = intervals[[i]], years_list = years_lists[[i]],
                                  in_folder, out_folder, 
                                  extent, WHC_present,
                                  ncores, foc_extrapol = TRUE)
  
}

# Downscale other variables
for(i in 1:length(intervals)){
  
  monthly_downscale(yr_interval = intervals[[i]], years_list = years_lists[[i]],
                    in_folder, out_folder, 
                    extent, WHC_present,
                    foc_extrapol = TRUE)
  
}
